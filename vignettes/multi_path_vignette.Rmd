---
title: "Multi-Path Stepwise selection Vignette"
author: "Lijuan Wang, Evan Jerome, Kira Noordwijk"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
library(finalprojectgroup12)
library(knitr)
set.seed(123)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE
)
```

# 1. Simulate Gaussian Regression Example
```{r}
# Simulate data

n <- 442
p <- 10
X <- matrix(rnorm(n*p), n, p)
colnames(X) <- paste0("x", 1:p)
beta <- c(1.5, -1, 0, 0, 0.8, rep(0, p-5))
y <- as.numeric(X %*% beta + rnorm(n))

# Multi-path forward selection

forest <- build_paths(x = X, y = y, family = "gaussian", K = 10, eps = 1e-6, delta = 1, L = 50)

# Show top 5 models

kable(head(forest$aic_by_model, 5), caption = "Top 5 linear models by AIC")

# Compute variable stability

stab <- stability(x = X, y = y, B = 50, resample = "bootstrap", family = "gaussian", K = 10)
stab_sorted <- sort(stab$pi, decreasing = TRUE)
kable(data.frame(variable = names(stab_sorted), stability = stab_sorted),
caption = "Variable stability (linear regression)")

# Select plausible models

plaus <- plausible_models(forest, pi = stab$pi, Delta = 2, tau = 0.6)
kable(plaus, caption = "Plausible linear models")

```

# 2. Simulated Logistic Regression Example
```{r}
# Simulate binary classification data

n <- 100
p <- 5
Xb <- matrix(rnorm(n*p), n, p)
linpred <- 1*Xb[,1] - 1.2*Xb[,2] + 0.8*Xb[,4]
prob <- 1 / (1 + exp(-linpred))
ybin <- rbinom(n, 1, prob)
colnames(Xb) <- paste0("x", 1:p)

# Multi-path forward selection

forest_bin <- build_paths(x = Xb, y = ybin, family = "binomial", K = 5, eps = 1e-6, delta = 1, L = 50)

# Show top 5 logistic models by AIC

kable(head(forest_bin$aic_by_model, 5), caption = "Top 5 logistic models by AIC")

# Compute variable stability

stab_bin <- stability(x = Xb, y = ybin, B = 20, resample = "bootstrap", family = "binomial", K = 5)
stab_bin_sorted <- sort(stab_bin$pi, decreasing = TRUE)
kable(data.frame(variable = names(stab_bin_sorted), stability = stab_bin_sorted),
caption = "Variable stability (logistic regression)")

# Select plausible models

plaus_bin <- plausible_models(forest_bin, pi = stab_bin$pi, Delta = 2, tau = 0.6)
kable(plaus_bin, caption = "Plausible logistic models")

# Optional: compute confusion metrics if implemented

# confusion_metrics(fit_bin, cutoff = 0.5)

```

