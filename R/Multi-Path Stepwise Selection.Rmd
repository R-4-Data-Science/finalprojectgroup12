---
title: "Multi-Path Stepwise Selection"
author: "Lijuan Wangï¼ŒEvan Jerome, Kira Noordwijk"
date: "2025-11-12"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Load package
library(finalprojectgroup12)
library(knitr)
set.seed(123)
```

# 1. Linear Regression Example (Gaussian)

```{r}
# Simulate data
n <- 80
p <- 6
X <- matrix(rnorm(n*p), n, p)
colnames(X) <- paste0("x", 1:p)
beta <- c(1.5, -1, 0, 0, 0.8, 0)
y <- as.numeric(X %*% beta + rnorm(n))

# Multi-path forward selection
forest <- build_paths(x = X, y = y, family = "gaussian", K = 6, eps = 1e-6, delta = 1, L = 50)

# Show top 5 models
kable(head(forest$aic_by_model, 5), caption = "Top 5 linear models by AIC")

# Compute variable stability
stab <- stability(x = X, y = y, B = 20, resample = "bootstrap", family = "gaussian", K = 6)

# Sorted output
stab_sorted <- sort(stab$pi, decreasing = TRUE)
kable(data.frame(variable = names(stab_sorted), stability = stab_sorted), caption = "Variable stability (linear)")

# Select plausible models
plaus <- plausible_models(forest, pi = stab$pi, Delta = 2)
kable(plaus, caption = "Plausible linear models")
```

# 2. Logistic Regression Example (Binomial)

```{r}
# Simulate binary classification data
n <- 100 
p <- 5
Xb <- matrix(rnorm(n*p), n, p)
linpred <- 1*Xb[,1] - 1.2*Xb[,2] + 0.8*Xb[,4]
prob <- 1 / (1 + exp(-linpred))
ybin <- rbinom(n, 1, prob)
colnames(Xb) <- paste0("x", 1:p)

# Multi-path forward selection
forest_bin <- build_paths(x = Xb, y = ybin, family = "binomial", K = 5, eps = 1e-6, delta = 1, L = 50)

# Show top 5 logistic models by AIC
kable(head(forest_bin$aic_by_model, 5), caption = "Top 5 logistic models by AIC")

# Compute variable stability
stab_bin <- stability(x = Xb, y = ybin, B = 20, resample = "bootstrap", family = "binomial", K = 5)

# Sort by stability
stab_bin_sorted <- sort(stab_bin$pi, decreasing = TRUE)
kable(data.frame(variable = names(stab_bin_sorted), stability = stab_bin_sorted), caption = "Variable stability (logistic)")


# Select plausible models
plaus_bin <- plausible_models(forest_bin, pi = stab_bin$pi, Delta = 2)
kable(plaus_bin, caption = "Plausible logistic models")



#Compute confusion matrix and standard metrics at cutoff 0.5
# Uncomment and use if confusion_metrics() is implemented
# confusion_metrics(fit, cutoff = 0.5)
```

